"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve and undersmoothed UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.det$h,col="red",lwd=2,lty=1)
lines(newdata$logexp, fm.food.det$h.upper,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower,col="red",lwd=2,lty=2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and data-driven UCBs
plot(logexp, fm.food.dd$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.75, 0.75),
col = "blue",
type = "l",
lwd=2,
lty=1)
## Plot the estimated Engel curve derivative and data-driven UCBs
plot(newdata$logexp, fm.food.dd$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.75, 0.75),
col = "blue",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.dd$h.upper.deriv,col="blue",lwd=2,lty=2)
lines(newdata$logexp, fm.food.dd$h.lower.deriv,col="blue",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.75, 0.75),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.75, 0.75),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower.deriv,col="red",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve and undersmoothed UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.det$h,
col = "red",
lwd = 2,
lty = 1)
lines(newdata$logexp, fm.food.det$h.upper,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h.lower,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logext, fm.food.det$h + 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 4)
fm.food.det$asy.se
## Plot the estimated Engel curve and undersmoothed UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.det$h,
col = "red",
lwd = 2,
lty = 1)
lines(newdata$logexp, fm.food.det$h.upper,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h.lower,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h + 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 4)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve and undersmoothed UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.det$h,
col = "red",
lwd = 2,
lty = 1)
lines(newdata$logexp, fm.food.det$h.upper,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h.lower,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h + 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 3)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve and undersmoothed UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.det$h,
col = "red",
lwd = 2,
lty = 1)
lines(newdata$logexp, fm.food.det$h.upper,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h.lower,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h + 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 3)
lines(newdata$logexp, fm.food.det$h - 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 3)
legend("topright",
legend=c("Estimate",
"95\\% UCBs",
"95\\% PCIs"),
col=c("red","red"),
lty=c(1,2,3),
lwd=c(2,2,2),
bty="n")
## Plot the estimated Engel curve derivative and data-driven UCBs
plot(newdata$logexp, fm.food.dd$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "blue",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.dd$h.upper.deriv,col="blue",lwd=2,lty=2)
lines(newdata$logexp, fm.food.dd$h.lower.deriv,col="blue",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower.deriv,col="red",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower.deriv,col="red",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and data-driven UCBs
plot(logexp, fm.fuel.dd$deriv,
ylab = "Change in Fuel Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "blue",
type = "l",
lwd=2,
lty=1)
fm.fuel.dd <- npiv(fuel ~ logexp | logwages, newdata = newdata)
summary(fm.fuel.dd)
## Plot the estimated Engel curve and data-driven UCBs
plot(logexp, fuel,
ylab = "Fuel Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.25),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.fuel.dd$h,col="blue",lwd=2,lty=1)
lines(newdata$logexp, fm.fuel.dd$h.upper,col="blue",lwd=2,lty=2)
lines(newdata$logexp, fm.fuel.dd$h.lower,col="blue",lwd=2,lty=2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and data-driven UCBs
plot(newdata$logexp, fm.fuel.dd$deriv,
ylab = "Change in Fuel Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "blue",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.fuel.dd$h.upper.deriv,col="blue",lwd=2,lty=2)
lines(newdata$logexp, fm.fuel.dd$h.lower.deriv,col="blue",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower.deriv,col="red",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
lines(newdata$logexp, fm.food.det$deriv + 1.96 * fm.food.det$deriv.asy.se,
col = "red",
lwd = 2,
lty = 3)
lines(newdata$logexp, fm.food.det$deriv - 1.96 * fm.food.det$deriv.asy.se,
col = "red",
lwd = 2,
lty = 3)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("red","red"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower.deriv,col="red",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
lines(newdata$logexp, fm.food.det$deriv + 1.96 * fm.food.det$deriv.asy.se,
col = "red",
lwd = 2,
lty = 3)
lines(newdata$logexp, fm.food.det$deriv - 1.96 * fm.food.det$deriv.asy.se,
col = "red",
lwd = 2,
lty = 3)
legend("topright",
legend=c("Estimate",
"95\\% UCBs",
"95\\% PCIs"),
col=c("red","red","red"),
lty=c(1,2,3),
lwd=c(2,2,2),
bty="n")
unlink("npiv_cache", recursive = TRUE)
unlink("npiv_cache", recursive = TRUE)
options(prompt = 'R> ',
continue = '+ ')
knitr::opts_chunk$set(cache=TRUE,dev='tikz')
if (!require("npiv")){
library(devtools)
install_github('JeffreyRacine/npiv')
}
library("npiv")
data("Engel95", package = "npiv")
head(Engel95)
Engel.kids <- subset(Engel95, nkids == 1)
attach(Engel.kids)
newdata <- data.frame(logexp = seq(4.75, 6.25, length.out = 1000))
fm.food.dd <- npiv(food ~ logexp | logwages, newdata = newdata)
summary(fm.food.dd)
fm.food.det <- npiv(food ~ logexp | logwages, newdata = newdata,
J.x.segments = 2, K.w.segments = 5)
## Plot the estimated Engel curve and data-driven UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.dd$h,col="blue",lwd=2,lty=1)
lines(newdata$logexp, fm.food.dd$h.upper,col="blue",lwd=2,lty=2)
lines(newdata$logexp, fm.food.dd$h.lower,col="blue",lwd=2,lty=2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve and undersmoothed UCBs
plot(logexp, food,
ylab = "Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(0, 0.4),
main = "",
type = "p",
cex = .5,
col = "lightgrey")
lines(newdata$logexp, fm.food.det$h,
col = "red",
lwd = 2,
lty = 1)
lines(newdata$logexp, fm.food.det$h.upper,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h.lower,
col = "red",
lwd = 2,
lty = 2)
lines(newdata$logexp, fm.food.det$h + 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 3)
lines(newdata$logexp, fm.food.det$h - 1.96 * fm.food.det$asy.se,
col = "red",
lwd = 2,
lty = 3)
legend("topright",
legend=c("Estimate",
"95\\% UCBs",
"95\\% PCIs"),
col=c("red","red","red"),
lty=c(1,2,3),
lwd=c(2,2,2),
bty="n")
## Plot the estimated Engel curve derivative and data-driven UCBs
plot(newdata$logexp, fm.food.dd$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "blue",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.dd$h.upper.deriv,col="blue",lwd=2,lty=2)
lines(newdata$logexp, fm.food.dd$h.lower.deriv,col="blue",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
legend("topright",
legend=c("Estimate",
"95\\% UCBs"),
col=c("blue","blue"),
lty=c(1,2),
lwd=c(2,2),
bty="n")
## Plot the estimated Engel curve derivative and undersmoothed UCBs
plot(newdata$logexp, fm.food.det$deriv,
ylab = "Change in Food Budget Share",
xlab = "log(Total Household Expenditure)",
xlim = c(4.75, 6.25),
ylim = c(-0.5, 0.5),
col = "red",
type = "l",
lwd=2,
lty=1)
lines(newdata$logexp, fm.food.det$h.upper.deriv,col="red",lwd=2,lty=2)
lines(newdata$logexp, fm.food.det$h.lower.deriv,col="red",lwd=2,lty=2)
abline(0, 0, col = "black", lty = 2, lwd = 2)
lines(newdata$logexp, fm.food.det$deriv + 1.96 * fm.food.det$deriv.asy.se,
col = "red",
lwd = 2,
lty = 3)
lines(newdata$logexp, fm.food.det$deriv - 1.96 * fm.food.det$deriv.asy.se,
col = "red",
lwd = 2,
lty = 3)
legend("topright",
legend=c("Estimate",
"95\\% UCBs",
"95\\% PCIs"),
col=c("red","red","red"),
lty=c(1,2,3),
lwd=c(2,2,2),
bty="n")
